<script lang="ts">
	import { goto } from "$app/navigation";
    
    let fetchLoading:boolean = false
    let fetchError:boolean = false
    const getLoginUrl = async() => {
        fetchLoading = true
        try {
            const response = await fetch("http://localhost:8000/auth/login");
            const responseJson = await response.json();
            
            if (!responseJson.data) {
                fetchError = true
            }
            
            const loginUrl = responseJson.data.login_url;
            goto(loginUrl)
        } catch (error) {
            if (error instanceof Error) {
                fetchError = true
            }
        }
    }
</script>

{#if fetchLoading === true}
    <div class="animate-spin">
        <svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48" fill="white"><path d="M480-80q-84 0-157-31t-127-85q-54-54-85-127T80-480q0-84 31-157t85-127q54-54 127-85t157-31q12 0 21 9t9 21q0 12-9 21t-21 9q-141 0-240.5 99.5T140-480q0 141 99.5 240.5T480-140q141 0 240.5-99.5T820-480q0-12 9-21t21-9q12 0 21 9t9 21q0 84-31 157t-85 127q-54 54-127 85T480-80Z"/></svg>
    </div>
{:else if  fetchError === true}
    <button class="text-red-500" on:click={getLoginUrl}>Retry</button>
{:else}
    <button class="text-blue-500" on:click={getLoginUrl}>Login</button>
{/if}
